# MDD 013_tuneup_011: Fix CodeRipple Package Path in GitHub Actions

## Problem Statement

**Issue**: CodeRipple package installation fails during Terraform deployment in GitHub Actions due to incorrect path resolution.

**Error**: 
```bash
ERROR: Invalid requirement: './../../***'
Hint: It looks like a path. File './../../***' does not exist.
‚ùå CodeRipple package import failed: No module named '***'
```

**Root Cause**: The relative path `./../../***` used in Terraform doesn't resolve correctly in the GitHub Actions workspace structure.

**Impact**: Lambda function runs in fallback mode without CodeRipple agents, defeating the purpose of the multi-agent documentation system.

## Root Cause Analysis

### **GitHub Actions Workspace Structure**
```
/home/runner/work/coderipple/coderipple/    # GitHub Actions workspace
‚îú‚îÄ‚îÄ coderipple/                             # CodeRipple Python package
‚îÇ   ‚îú‚îÄ‚îÄ setup.py                           # ‚úÖ Package configuration
‚îÇ   ‚îú‚îÄ‚îÄ src/                               # ‚úÖ Package source code
‚îÇ   ‚îî‚îÄ‚îÄ [package files]
‚îú‚îÄ‚îÄ infra/
‚îÇ   ‚îî‚îÄ‚îÄ terraform/
‚îÇ       ‚îî‚îÄ‚îÄ lambda_build/                   # ‚Üê Terraform execution context
‚îî‚îÄ‚îÄ [other project files]
```

### **Path Resolution Issue**
**Current Terraform Command**:
```bash
cd ${path.module}/lambda_build              # /home/runner/work/coderipple/coderipple/infra/terraform/lambda_build/
python3 -m pip install ./../../*** -t .    # Resolves to ./../../*** (doesn't exist)
```

**Expected Path**: `/home/runner/work/coderipple/coderipple/coderipple/` (the actual package location)

### **Verification from Logs**
- ‚úÖ **Strands SDK**: Successfully installed (183M package size)
- ‚úÖ **Lambda Handler**: Copied correctly to root
- ‚ùå **CodeRipple Package**: Path resolution failure
- ‚úÖ **Lambda Deployment**: Function updated (version 10)

## Solution Strategy

### **Approach**: Fix Relative Path Resolution in GitHub Actions

**Objective**: Update the Terraform script to use the correct path to the CodeRipple package in the GitHub Actions workspace.

### **Implementation**

**Current Problematic Code**:
```bash
python3 -m pip install ./../../*** -t .
```

**Correct Fixed Code**:
```bash
python3 -m pip install ../../../coderipple -t .
```

**Path Analysis**:
```bash
# Current location: /home/runner/work/coderipple/coderipple/infra/terraform/lambda_build/
# Target location:  /home/runner/work/coderipple/coderipple/coderipple/
# 
# Path breakdown:
# ../          - up from lambda_build to terraform
# ../          - up from terraform to infra  
# ../          - up from infra to repository root
# coderipple   - into the CodeRipple package directory
```

## Implementation Plan

### **Step 1: Update Terraform Package Assembly**

Modify the `null_resource.prepare_lambda_package` in `infra/terraform/main.tf`:

```bash
# Install all dependencies including CodeRipple package
cd ${path.module}/lambda_build
python3 -m pip install -r requirements.txt -t .

# Fix: Use correct relative path to CodeRipple package
python3 -m pip install ../../../coderipple -t .
```

### **Step 2: Add Path Verification**

Add debugging to verify the path exists before installation:

```bash
# Verify CodeRipple package path exists
echo "üîç Checking CodeRipple package path..."
if [ -f "../../../coderipple/setup.py" ]; then
    echo "‚úÖ CodeRipple package found at ../../../coderipple"
    python3 -m pip install ../../../coderipple -t .
else
    echo "‚ùå CodeRipple package not found at ../../../coderipple"
    echo "üìÇ Available paths:"
    ls -la ../../../
    exit 1
fi
```

## Expected Outcomes

### **System Response Changes**
**Before Fix:**
```json
{"message": "Webhook processed in fallback mode (no agents available)"}
```

**After Fix:**
```json
{
  "message": "Webhook processed successfully",
  "agents_invoked": ["tourist_guide", "building_inspector"],
  "documentation_updated": true,
  "ai_powered": true
}
```

## Success Criteria

- [x] CodeRipple package installs successfully in GitHub Actions
- [x] All three documentation agents available in Lambda
- [x] Lambda function operates in multi-agent mode
- [x] Webhook processing returns success with agent details
- [x] AI-powered documentation generation functional
