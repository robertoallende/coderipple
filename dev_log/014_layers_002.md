# MDD 014_layers_002: Import Path Resolution and Diagnostic Testing Framework

## Problem Statement

**Issue**: GitHub Actions CI/CD pipeline failing with 22 import errors due to inconsistent import patterns across test files and examples, preventing successful deployment validation.

**Current Pain Points**:
- Test files using direct module imports (`from bedrock_integration_tools import`) instead of package imports (`from coderipple.bedrock_integration_tools import`)
- Mixed import patterns across codebase (`src.module_name` vs `module_name` vs `coderipple.module_name`)
- No diagnostic framework to identify and debug import issues systematically
- CI/CD environment has different PYTHONPATH configuration than local development
- 22 test files and examples failing to import, blocking automated testing pipeline

**Root Cause**: Transition from script-based development to proper Python package structure without updating import statements consistently across all test and example files.

## Strategic Objectives

### Primary Goals
1. **Fix All Import Path Issues** - Standardize imports to use proper `coderipple.*` package structure
2. **Create Diagnostic Testing Framework** - Comprehensive import validation with actionable error reporting
3. **Restore CI/CD Pipeline Functionality** - Enable automated testing and deployment validation
4. **Prevent Future Import Issues** - Establish guidelines and validation to catch import problems early

### Secondary Goals
1. **Improve Developer Experience** - Clear error messages and debugging information when imports fail
2. **Establish Import Standards** - Consistent import patterns across entire codebase
3. **Enable Robust Testing** - Comprehensive validation of package structure and imports
4. **Support Layer Architecture** - Ensure import compatibility with Lambda layers implementation

## Implementation Architecture

### Diagnostic Testing Framework
- **Comprehensive Import Validation**: Test all expected `coderipple.*` imports systematically
- **Environment Analysis**: Display Python path, working directory, and package discovery results
- **Actionable Error Reporting**: Provide specific import statements that should work
- **Package Structure Discovery**: List available modules and packages for debugging

### Import Standardization Strategy
- **Consistent Package Imports**: All imports use `from coderipple.module_name import` pattern
- **Remove Legacy Patterns**: Eliminate `src.` prefixes and direct module imports
- **Validation Integration**: Ensure compatibility with both local development and CI/CD environments

## Unit 14.2 Implementation Plan

### **Phase 1: Diagnostic Test Creation**
**Objective**: Create comprehensive import diagnostic framework

**Tasks**:
1. **Create `tests/test_import_diagnostics.py`**
   - Test all expected `coderipple.*` imports systematically
   - Display available packages/modules when imports fail
   - Show current Python path and working directory
   - Provide package structure discovery results
   - Generate actionable error messages with suggested fixes

**Expected Outcome**: Robust diagnostic test that identifies import issues and provides clear guidance for resolution

### **Phase 2: Fix Example Files Import Issues**
**Objective**: Standardize imports in all example files

**Tasks**:
1. **Fix `examples/test_bedrock_demo.py`**
   - Change: `from bedrock_integration_tools import` → `from coderipple.bedrock_integration_tools import`

2. **Fix `examples/test_bedrock_mock_demo.py`**
   - Change: `from bedrock_integration_tools import` → `from coderipple.bedrock_integration_tools import`

3. **Fix `examples/test_edge_cases.py`**
   - Change: `from git_analysis_tool import` → `from coderipple.git_analysis_tool import`

4. **Fix remaining example files**:
   - `examples/test_git_agent.py`
   - `examples/test_tourist_guide_bedrock.py`
   - `examples/test_webhook.py`

**Expected Outcome**: All example files use consistent `coderipple.*` import patterns

### **Phase 3: Fix Test Files Import Issues**
**Objective**: Standardize imports in all test files

**Tasks**:
1. **Fix core test files**:
   - `tests/test_source_code_analysis_tool.py`: `from source_code_analysis_tool import` → `from coderipple.source_code_analysis_tool import`
   - `tests/test_tourist_guide_agent.py`: `from tourist_guide_agent import` → `from coderipple.tourist_guide_agent import`
   - `tests/test_tourist_guide_agent_fixed.py`: `from webhook_parser import` → `from coderipple.webhook_parser import`
   - `tests/test_webhook_parser.py`: `from src.webhook_parser import` → `from coderipple.webhook_parser import`

2. **Fix remaining test files** (18 additional files):
   - `tests/test_agent_context_flow.py`
   - `tests/test_bedrock_integration_tools.py`
   - `tests/test_building_inspector_agent.py`
   - `tests/test_content_aware_update_logic.py`
   - `tests/test_content_generation_tools.py`
   - `tests/test_content_validation_tools.py`
   - `tests/test_existing_content_discovery_tool.py`
   - `tests/test_git_analysis_tool.py`
   - `tests/test_historian_agent.py`
   - `tests/test_orchestrator_agent.py`
   - `tests/test_quality_alignment_tools.py`
   - `tests/test_real_diff_integration_tools.py`

**Expected Outcome**: All test files use consistent `coderipple.*` import patterns

### **Phase 4: Validation & Testing**
**Objective**: Verify fixes and ensure CI/CD compatibility

**Tasks**:
1. **Run diagnostic test locally** to verify it catches issues correctly
2. **Test import fixes locally** with pytest to ensure they work
3. **Update any relative imports within the coderipple package** if needed
4. **Verify CI/CD compatibility** by checking PYTHONPATH expectations

**Expected Outcome**: All import issues resolved, CI/CD pipeline passes successfully

### **Phase 5: Documentation & Prevention**
**Objective**: Establish standards and prevent future issues

**Tasks**:
1. **Add import guidelines** to development documentation
2. **Consider adding import linting rules** to prevent future issues
3. **Document diagnostic test usage** for future debugging

**Expected Outcome**: Clear guidelines and tools to prevent future import issues

## Key Diagnostic Features

The diagnostic test framework will provide:

### **Environment Analysis**
- Current Python path and working directory
- Package installation status and locations
- Available modules discovery and listing
- Python version and pytest version information

### **Import Validation**
- Systematic testing of all expected `coderipple.*` imports
- Specific failure reporting with exact error messages
- Suggested fixes with correct import statements
- Comparison of expected vs. actual import behavior

### **Actionable Reporting**
- Clear identification of which imports are failing
- Specific suggestions for fixing each import issue
- Environment-specific guidance for local vs. CI/CD differences
- Package structure visualization for debugging

## Expected Outcomes

### Immediate Benefits
- **CI/CD Pipeline Restored**: All 22 import errors resolved, automated testing functional
- **Consistent Import Patterns**: Standardized `coderipple.*` imports across entire codebase
- **Robust Diagnostic Framework**: Comprehensive import validation with clear error reporting
- **Developer Productivity**: Clear guidance when import issues occur

### Architectural Improvements
- **Package Structure Validation**: Systematic verification of Python package integrity
- **Layer Architecture Compatibility**: Import patterns compatible with Lambda layers
- **Testing Framework Enhancement**: Comprehensive validation prevents deployment issues
- **Development Standards**: Clear guidelines for import patterns and package structure

### Quality Improvements
- **Automated Issue Detection**: Diagnostic tests catch import problems before deployment
- **Clear Error Resolution**: Actionable error messages guide developers to solutions
- **Consistent Development Experience**: Same import patterns work in local and CI/CD environments
- **Future Issue Prevention**: Guidelines and validation prevent recurring import problems

## Success Criteria

### Technical Metrics
- [ ] All 22 import errors in CI/CD pipeline resolved
- [ ] Diagnostic test framework successfully identifies and reports import issues
- [ ] 100% of test files use consistent `coderipple.*` import patterns
- [ ] 100% of example files use consistent `coderipple.*` import patterns
- [ ] CI/CD pipeline passes all tests successfully

### Quality Metrics
- [ ] Zero import-related deployment failures
- [ ] Comprehensive diagnostic information available when imports fail
- [ ] Clear documentation and guidelines for import patterns
- [ ] Automated validation prevents future import issues
- [ ] Developer onboarding improved with clear import standards

## Risk Assessment

### Low Risk
- **Import Pattern Standardization**: Straightforward find-and-replace operations
- **Diagnostic Test Creation**: Non-breaking addition to test suite
- **Documentation Updates**: Additive improvements to development guidelines

### Medium Risk
- **CI/CD Environment Differences**: PYTHONPATH configuration may require adjustment
- **Package Structure Dependencies**: Changes may affect other parts of the system
- **Testing Coverage**: Ensuring all import patterns are identified and fixed

### Mitigation Strategies
- **Comprehensive Testing**: Run diagnostic tests in both local and CI/CD environments
- **Incremental Implementation**: Fix imports in phases to identify issues early
- **Rollback Capability**: Maintain ability to revert changes if issues arise
- **Environment Validation**: Verify PYTHONPATH and package installation in CI/CD

## Implementation Timeline

### Phase 1: Diagnostic Framework 
- Create comprehensive import diagnostic test
- Validate diagnostic test catches existing issues
- **Duration**: 1 development session

### Phase 2: Example Files 
- Fix all example file imports
- Test example files locally
- **Duration**: 1 development session

### Phase 3: Test Files
- Fix all test file imports
- Validate test suite runs successfully
- **Duration**: 2 development sessions

### Phase 4: Validation 
- Run full test suite locally and in CI/CD
- Verify all import issues resolved
- **Duration**: 1 development session

### Phase 5: Documentation 
- Update development guidelines
- Document diagnostic test usage
- **Duration**: 1 development session

## Technical Foundation

This unit builds upon:
- **Package structure** established in CodeRipple development
- **Layer architecture** from Unit 14.1
- **CI/CD pipeline** from previous development cycles
- **Testing framework** from Units 12.1-12.4

## Next Steps

1. **Begin Phase 1**: Create comprehensive import diagnostic test framework
2. **Execute Phase 2**: Fix example file imports systematically
3. **Execute Phase 3**: Fix test file imports systematically
4. **Validate Phase 4**: Ensure CI/CD pipeline passes successfully
5. **Document Phase 5**: Establish import guidelines and standards

This implementation will restore CI/CD functionality and establish robust import validation, enabling successful deployment of the Lambda layers architecture from Unit 14.1.
